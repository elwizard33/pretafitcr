---
// CrossFit Schedule component for Preta Fit Jacó
import { schedules } from '../../data/schedules';

// Async function to fetch schedules for streaming optimization
async function fetchSchedules() {
  // Simulate potential async data fetching (e.g., API calls) for streaming
  await new Promise(resolve => setTimeout(resolve, 30));
  
  try {
    const validatedSchedules = schedules?.crossfit;
    if (!validatedSchedules || !Array.isArray(validatedSchedules) || validatedSchedules.length === 0) {
      throw new Error('Invalid or empty schedules data');
    }
    return validatedSchedules;
  } catch (error) {
    console.error('Error loading schedules:', error);
    // Provide fallback schedule data
    return [
      {
        dayLetter: 'L-V',
        dayName: 'Lunes a Viernes',
        morningTimes: ['6:00 AM', '7:00 AM'],
        afternoonTimes: ['6:00 PM', '7:00 PM']
      }
    ];
  }
}

// Await schedules for streaming optimization
const validatedSchedules = await fetchSchedules();
---

<section id="schedule" class="section">
  <div class="container">
    <div class="overline">Horarios</div>
    <h2 class="h2">Horarios de CrossFit</h2>
    <p class="text-center text-muted mb-8 text-lg max-sm:text-base">
      Nuestras clases de CrossFit están diseñadas para todos los niveles. Elige el horario que mejor se adapte a tu rutina.
    </p>
    
    {validatedSchedules && validatedSchedules.length > 0 ? (
      <div class="bg-card border border-line rounded-[14px] overflow-hidden shadow-custom">
        <div class="grid grid-cols-5 border-b border-line max-md:grid-cols-2 max-sm:grid-cols-1">
          {validatedSchedules.map((day) => (
            <div class="border-r border-line last:border-r-0 max-sm:border-r-0 max-sm:border-b max-sm:last:border-b-0">
              <div class="bg-brand text-white p-4 text-center flex flex-col gap-1 max-md:p-3">
                <span class="text-2xl font-bold max-md:text-xl">{day.dayLetter || 'N/A'}</span>
                <span class="text-sm opacity-90">{day.dayName || 'Día no disponible'}</span>
              </div>
              
              <div class="min-h-[200px] max-sm:min-h-0">
                {day.morningTimes && day.morningTimes.length > 0 && (
                  <div class="p-4 border-b border-line bg-slate-50 text-ink max-md:p-3">
                    {day.morningTimes.map((time) => (
                      <div class="py-2 font-medium text-ink border-b border-slate-200 text-center last:border-b-0">{time || 'Hora N/A'}</div>
                    ))}
                  </div>
                )}
                
                {day.afternoonTimes && day.afternoonTimes.length > 0 && (
                  <div class="p-4 bg-white text-ink max-md:p-3">
                    {day.afternoonTimes.map((time) => (
                      <div class="py-2 font-medium text-ink border-b border-slate-200 text-center last:border-b-0">{time || 'Hora N/A'}</div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>

        <div class="grid grid-cols-2 border-t border-line max-md:grid-cols-1">
          <div class="border-r border-line flex flex-col max-md:border-r-0 max-md:border-b max-md:last:border-b-0">
            <div class="bg-brand text-white p-4 text-center flex flex-col gap-1 max-md:p-3">
              <span class="text-2xl font-bold max-md:text-xl">S</span>
              <span class="text-sm opacity-90">Sábado</span>
            </div>
            <div class="flex flex-col p-4 flex-grow max-md:p-3">
              <span class="py-2 font-medium text-ink border-b border-slate-200 text-center">7:00 AM</span>
              <span class="py-2 font-medium text-ink text-center">8:00 AM</span>
            </div>
          </div>
          <div class="flex flex-col">
            <div class="bg-brand text-white p-4 text-center flex flex-col gap-1 max-md:p-3">
              <span class="text-2xl font-bold max-md:text-xl">D</span>
              <span class="text-sm opacity-90">Domingo</span>
            </div>
            <div class="py-2 font-medium text-ink text-center flex-grow flex items-center justify-center m-4 italic">Cerrado</div>
          </div>
        </div>
      </div>
    ) : (
      <div class="text-center py-12 px-8 bg-card border border-line rounded-[14px] text-muted">
        <div class="mb-4 opacity-60">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="#e5e7eb"/>
          </svg>
        </div>
        <h3 class="mb-2 text-ink text-xl font-medium">Horarios no disponibles</h3>
        <p class="mb-6 text-sm leading-relaxed">Por favor contactanos directamente para conocer nuestros horarios actualizados.</p>
        <a href="tel:+50670092140" class="inline-flex items-center gap-2 bg-brand text-white no-underline py-3 px-6 rounded-full font-semibold transition-all duration-200 hover:bg-brand-600 hover:-translate-y-0.5">Llamar +506 7009-2140</a>
      </div>
    )}

    <div class="mt-8 text-center">
      <div class="inline-flex items-center gap-2 bg-sky-50 border border-sky-200 rounded-lg py-4 px-6 text-sky-800 font-medium max-md:flex-col max-md:text-center max-md:gap-3 max-md:py-3 max-md:px-4">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="var(--color-brand)"/>
        </svg>
        <span>Reserva tu clase con anticipación para garantizar tu cupo</span>
      </div>
    </div>
  </div>
</section>
